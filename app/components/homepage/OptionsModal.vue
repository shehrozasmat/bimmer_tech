<template>
  <div v-if="open" class="fixed inset-0 z-50">
    <div class="absolute inset-0 bg-black/70" @click="$emit('close')"></div>
    <div class="absolute inset-0 flex items-center justify-center" @keyup.esc="$emit('close')">
      <div class="w-full max-w-5xl bg-neutral-900 text-neutral-100 shadow-2xl ring-1 ring-white/10 overflow-hidden p-5">
        <div class="w-full text-right">
        <button type="button" class="relative right-0 text-neutral-500 hover:text-neutral-800" @click="$emit('close')" aria-label="Close">✕</button>
        </div>

        <div class="p-10">

        <div class="relative w-12/12 m-auto">
          <div class="flex items-center gap-3 h-[73px] bg-white items-center pt-5 p-2 pr-12">
            <svg width="38" height="38" viewBox="0 0 38 38" fill="none" xmlns="http://www.w3.org/2000/svg" class="shrink-0 ml-10">
              <path d="M24.117 28.4015L14.6854 18.9699L24.0524 9.59526C24.0712 9.57655 24.086 9.55434 24.0962 9.52989C24.1063 9.50544 24.1115 9.47923 24.1115 9.45276C24.1115 9.42629 24.1063 9.40008 24.0962 9.37563C24.086 9.35118 24.0712 9.32896 24.0524 9.31026L15.0464 0.334656C14.9049 0.197035 14.7293 0.0995229 14.5377 0.0521133C14.346 0.00470371 14.1452 0.00910164 13.9558 0.0648564C13.7279 0.145329 13.5314 0.29619 13.3948 0.495643C13.2582 0.695096 13.1885 0.932815 13.1958 1.17446V17.4803L2.95103 7.23926C2.89277 7.18066 2.82349 7.13416 2.74719 7.10243C2.67089 7.0707 2.58907 7.05436 2.50643 7.05436C2.4238 7.05436 2.34198 7.0707 2.26568 7.10243C2.18938 7.13416 2.1201 7.18066 2.06183 7.23926C1.94533 7.35792 1.88006 7.51756 1.88006 7.68386C1.88006 7.85015 1.94533 8.0098 2.06183 8.12846L12.9184 18.9661L1.99343 29.8683C1.93369 29.9267 1.88621 29.9964 1.8538 30.0734C1.82138 30.1504 1.80469 30.2331 1.80469 30.3167C1.80469 30.4002 1.82138 30.4829 1.8538 30.5599C1.88621 30.6369 1.93369 30.7067 1.99343 30.7651C2.11168 30.8821 2.27053 30.949 2.43688 30.9518C2.60324 30.9547 2.76427 30.8932 2.88643 30.7803L13.1844 20.4671V36.8071C13.1771 37.0487 13.2468 37.2864 13.3834 37.4859C13.52 37.6853 13.7165 37.8362 13.9444 37.9167C14.0464 37.9494 14.1528 37.9661 14.2598 37.9661C14.5459 37.963 14.8191 37.8469 15.0198 37.6431L24.0638 28.6409C24.0839 28.6227 24.0997 28.6003 24.1102 28.5754C24.1207 28.5504 24.1256 28.5235 24.1246 28.4965L24.117 28.4015ZM22.4184 28.5003L14.4384 36.4803V20.5203L22.4184 28.5003ZM14.4384 17.4233V1.52026L22.4184 9.45846L14.4384 17.4233Z" fill="#267778"/>
              <path d="M24.2883 14.638C24.2277 14.5706 24.1483 14.5229 24.0603 14.5012H23.9273C23.8544 14.499 23.782 14.514 23.7159 14.545C23.6499 14.576 23.5921 14.6222 23.5473 14.6798L19.7055 18.5938C19.5808 18.7219 19.5113 18.8938 19.5117 19.0726C19.5151 19.251 19.5872 19.4212 19.7131 19.5476L23.5587 23.3324C23.6402 23.4096 23.7394 23.4657 23.8475 23.4958C23.9153 23.5086 23.9849 23.5086 24.0527 23.4958C24.1398 23.4767 24.2185 23.4301 24.2769 23.3628C28.1187 18.932 24.3187 14.676 24.2883 14.638ZM23.8095 15.8236L23.9083 15.9604L23.9387 16.006C24.5581 16.918 25.8387 19.3728 23.9387 22.0024L23.9007 22.0556L23.8057 22.181L20.7391 19.0574L23.8095 15.8236Z" fill="#267778"/>
              <path d="M27.2796 27.5694C27.1561 27.571 27.0349 27.5358 26.9314 27.4684C26.828 27.401 26.7469 27.3044 26.6984 27.1908C26.6499 27.0772 26.6363 26.9517 26.6593 26.8304C26.6823 26.709 26.7408 26.5973 26.8274 26.5092C34.1538 18.8902 27.139 11.8032 26.8274 11.503C26.7192 11.3846 26.6605 11.2291 26.6634 11.0687C26.6663 10.9082 26.7307 10.755 26.8431 10.6406C26.9556 10.5262 27.1077 10.4592 27.2681 10.4535C27.4284 10.4478 27.5849 10.5038 27.7052 10.61C27.7888 10.6898 35.9132 18.856 27.7052 27.3794C27.5923 27.4941 27.4403 27.562 27.2796 27.5694Z" fill="#267778"/>
              <path d="M31.3974 31.1604C31.2365 31.1608 31.0815 31.0996 30.9642 30.9894C30.844 30.875 30.774 30.7174 30.7697 30.5514C30.7655 30.3855 30.8272 30.2246 30.9414 30.104C41.6156 18.818 31.3936 8.32624 30.9414 7.88544C30.8343 7.76602 30.7771 7.61012 30.7815 7.44979C30.7858 7.28946 30.8515 7.1369 30.9649 7.02349C31.0783 6.91008 31.2308 6.84444 31.3912 6.84008C31.5515 6.83571 31.7074 6.89296 31.8268 7.00004C31.9446 7.11784 43.3598 18.78 31.8268 30.9666C31.7141 31.0843 31.5602 31.1537 31.3974 31.1604Z" fill="#267778"/>
            </svg>
            <h4 class="text-base font-semibold text-teal-custom">{{ item?.title || 'Coding option details' }}</h4>
            <div class="absolute right-6 flex items-center gap-3">
              <div v-if="price != null" class="text-sm font-semibold text-black/80 bg-teal-100 px-2 py-1 rounded">{{ formatPrice(price) }}</div>
              <Select :label="'Add to cart'" @click="onSelect" />
            </div>
          </div>

          <div v-if="item?.category" class="absolute left top-0 w-8 bg-[#1E99AA] text-black/90 flex items-center justify-center h-[73px]">
            <span class="text-[10px] font-semibold tracking-wider text-center" style="writing-mode: vertical-rl; text-orientation: mixed;">{{ item.category }}</span>
          </div>
        </div>
        <!-- body -->
        <div class="px-6 py-6 space-y-6">
          <div class="space-y-4">
            <p v-for="(p, idx) in paragraphs" :key="idx" class="text-sm leading-relaxed text-neutral-200">{{ 'Are you tired of seeing the legal disclaimer on your iDrive screen every time you start your car or drive in reverse? We know the feeling. What if we told you it was possible to turn off the legal disclaimer on BMW so you would never see it ever again?   Our legal disclaimer deactivation in BMW will disable even the Night Vision pop-up! As responsible drivers, you know the legal disclaimers by heart. Do you really need to see them again?' }}</p>
          </div>

          <div v-if="videoUrl" class="flex justify-center">
            <div class="w-full max-w-2xl aspect-video overflow-hidden rounded-md ring-1 ring-white/10">
              <iframe :src="embedUrl" title="Video" class="w-full h-full" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
            </div>
          </div>
        </div>
        <div class="px-6 pb-8">
        </div>
        </div>
      </div>
    </div>
  </div>
</template>
<script setup lang="ts">
import { computed } from 'vue'
import Select from "~/components/elements/buttons/Select.vue";
type OptionItem = {
  id: string
  title: string
  subtitle: string
  category: string
  details?: string
  description?: string | string[]
  price?: number
  oldPrice?: number
  videoUrl?: string
}

const props = defineProps<{ open: boolean; item: OptionItem | null }>()
const emit = defineEmits<{ (e: 'close'): void; (e: 'select', item: OptionItem | null): void }>()

const price = computed(() => props.item?.price)
const oldPrice = computed(() => props.item?.oldPrice)
const videoUrl = computed(() => props.item?.videoUrl || '')

const paragraphs = computed(() => {
  const desc = props.item?.description
  const details = props.item?.details || props.item?.subtitle || ''
  if (Array.isArray(desc)) return desc
  if (typeof desc === 'string' && desc.trim().length) return [desc]
  return [details]
})

function formatPrice(v?: number) {
  if (v == null) return ''
  return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD', maximumFractionDigits: 0 }).format(v)
}

const embedUrl = computed(() => {
  if (!videoUrl.value) return ''
  const url = new URL(videoUrl.value, 'https://www.youtube.com/watch?v=MOI3jcXk3Ts')
  if (videoUrl.value.includes('youtube.com/watch') || videoUrl.value.includes('youtu.be')) {
    let id = ''
    if (url.hostname.includes('youtu.be')) {
      id = url.pathname.slice(1)
    } else {
      id = url.searchParams.get('v') || ''
    }
    return id ? `https://www.youtube.com/embed/${id}` : videoUrl.value
  }
  return videoUrl.value
})

function onSelect() {
  emit('select', props.item ?? null)
}
</script>

